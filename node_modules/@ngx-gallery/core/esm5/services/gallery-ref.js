/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import * as tslib_1 from "tslib";
import { BehaviorSubject } from 'rxjs/BehaviorSubject';
import { filter } from 'rxjs/operators/filter';
import { defaultConfig, defaultState } from '../utils/gallery.default';
import { GalleryAction } from '../models';
var GalleryRef = /** @class */ (function () {
    function GalleryRef(config, state) {
        if (config === void 0) { config = defaultConfig; }
        if (state === void 0) { state = defaultState; }
        this.config = config;
        this.state = state;
        this.state$ = new BehaviorSubject(state);
        this.config$ = new BehaviorSubject(defaultConfig);
        this.setConfig(config);
    }
    /**
     * Set gallery config
     * @param config
     */
    /**
     * Set gallery config
     * @param {?} config
     * @return {?}
     */
    GalleryRef.prototype.setConfig = /**
     * Set gallery config
     * @param {?} config
     * @return {?}
     */
    function (config) {
        this.config = tslib_1.__assign({}, defaultConfig, this.config, config);
        this.config$.next(this.config);
    };
    /**
     * Set gallery state
     * @param state
     */
    /**
     * Set gallery state
     * @param {?} state
     * @return {?}
     */
    GalleryRef.prototype.setState = /**
     * Set gallery state
     * @param {?} state
     * @return {?}
     */
    function (state) {
        this.state = tslib_1.__assign({}, this.state, state);
        this.state$.next(this.state);
    };
    /** Add gallery item
     * @param item - Gallery item object
     * @param active - Set the new item as current slide
     */
    /**
     * Add gallery item
     * @param {?} item - Gallery item object
     * @param {?=} active - Set the new item as current slide
     * @return {?}
     */
    GalleryRef.prototype.add = /**
     * Add gallery item
     * @param {?} item - Gallery item object
     * @param {?=} active - Set the new item as current slide
     * @return {?}
     */
    function (item, active) {
        var /** @type {?} */ items = tslib_1.__spread(this.state.items, [item]);
        this.setState({
            action: GalleryAction.ITEMS_CHANGED,
            items: items,
            hasNext: items.length > 1,
            currIndex: active ? items.length - 1 : this.state.currIndex
        });
    };
    /** Remove gallery item
     * @param i - Item index
     */
    /**
     * Remove gallery item
     * @param {?} i - Item index
     * @return {?}
     */
    GalleryRef.prototype.remove = /**
     * Remove gallery item
     * @param {?} i - Item index
     * @return {?}
     */
    function (i) {
        var /** @type {?} */ items = tslib_1.__spread(this.state.items.slice(0, i), this.state.items.slice(i + 1, this.state.items.length));
        this.setState({
            action: GalleryAction.ITEMS_CHANGED,
            items: items,
            hasNext: items.length > 1,
            hasPrev: i > 0
        });
    };
    /**
     * Load items and reset the state
     * @param items - Gallery images data
     */
    /**
     * Load items and reset the state
     * @param {?} items - Gallery images data
     * @return {?}
     */
    GalleryRef.prototype.load = /**
     * Load items and reset the state
     * @param {?} items - Gallery images data
     * @return {?}
     */
    function (items) {
        if (items) {
            this.setState({
                action: GalleryAction.ITEMS_CHANGED,
                items: items,
                hasNext: items.length > 1,
                hasPrev: false
            });
        }
    };
    /**
     * Set active item
     * @param i - Active Index
     * @param action - Action type
     */
    /**
     * Set active item
     * @param {?} i - Active Index
     * @return {?}
     */
    GalleryRef.prototype.set = /**
     * Set active item
     * @param {?} i - Active Index
     * @return {?}
     */
    function (i) {
        if (i !== this.state.currIndex) {
            this.setState({
                action: GalleryAction.INDEX_CHANGED,
                currIndex: i,
                hasNext: i < this.state.items.length - 1,
                hasPrev: i > 0
            });
        }
    };
    /**
     * Next item
     */
    /**
     * Next item
     * @return {?}
     */
    GalleryRef.prototype.next = /**
     * Next item
     * @return {?}
     */
    function () {
        if (this.state.hasNext) {
            this.set(this.state.currIndex + 1);
        }
        else if (this.config.loop) {
            this.set(0);
        }
    };
    /**
     * Prev item
     */
    /**
     * Prev item
     * @return {?}
     */
    GalleryRef.prototype.prev = /**
     * Prev item
     * @return {?}
     */
    function () {
        if (this.state.hasPrev) {
            this.set(this.state.currIndex - 1);
        }
        else if (this.config.loop) {
            this.set(this.state.items.length - 1);
        }
    };
    /**
     * Reset gallery to initial state
     */
    /**
     * Reset gallery to initial state
     * @return {?}
     */
    GalleryRef.prototype.reset = /**
     * Reset gallery to initial state
     * @return {?}
     */
    function () {
        this.setState(defaultState);
    };
    /**
     * Destroy GalleryRef (for internal use only)
     */
    /**
     * Destroy GalleryRef (for internal use only)
     * @return {?}
     */
    GalleryRef.prototype.destroy = /**
     * Destroy GalleryRef (for internal use only)
     * @return {?}
     */
    function () {
        this.state$.complete();
        this.config$.complete();
    };
    /** Gallery Events */
    /**
     * Stream that emits when gallery is initialized/reset
     */
    /**
     * Stream that emits when gallery is initialized/reset
     * @return {?}
     */
    GalleryRef.prototype.initialized = /**
     * Stream that emits when gallery is initialized/reset
     * @return {?}
     */
    function () {
        return this.state$.pipe(filter(function (state) { return state.action === GalleryAction.INITIALIZED; }));
    };
    /**
     * Stream that emits when items is changed (items loaded, item added, item removed)
     */
    /**
     * Stream that emits when items is changed (items loaded, item added, item removed)
     * @return {?}
     */
    GalleryRef.prototype.itemsChanged = /**
     * Stream that emits when items is changed (items loaded, item added, item removed)
     * @return {?}
     */
    function () {
        return this.state$.pipe(filter(function (state) { return state.action === GalleryAction.ITEMS_CHANGED; }));
    };
    /**
     * Stream that emits when current item is changed
     */
    /**
     * Stream that emits when current item is changed
     * @return {?}
     */
    GalleryRef.prototype.indexChanged = /**
     * Stream that emits when current item is changed
     * @return {?}
     */
    function () {
        return this.state$.pipe(filter(function (state) { return state.action === GalleryAction.INDEX_CHANGED; }));
    };
    return GalleryRef;
}());
export { GalleryRef };
function GalleryRef_tsickle_Closure_declarations() {
    /** @type {?} */
    GalleryRef.prototype.state$;
    /** @type {?} */
    GalleryRef.prototype.config$;
    /** @type {?} */
    GalleryRef.prototype.config;
    /** @type {?} */
    GalleryRef.prototype.state;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2FsbGVyeS1yZWYuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9Abmd4LWdhbGxlcnkvY29yZS8iLCJzb3VyY2VzIjpbInNlcnZpY2VzL2dhbGxlcnktcmVmLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ3ZELE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUUvQyxPQUFPLEVBQUUsYUFBYSxFQUFFLFlBQVksRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ3ZFLE9BQU8sRUFHTCxhQUFhLEVBRWQsTUFBTSxXQUFXLENBQUM7QUFFbkIsSUFBQTtJQUlFLG9CQUNTLFFBQ0E7OztRQURBLFdBQU0sR0FBTixNQUFNO1FBQ04sVUFBSyxHQUFMLEtBQUs7UUFFWixJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksZUFBZSxDQUFlLEtBQUssQ0FBQyxDQUFDO1FBQ3ZELElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxlQUFlLENBQWdCLGFBQWEsQ0FBQyxDQUFDO1FBQ2pFLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUM7S0FDeEI7SUFFRDs7O09BR0c7Ozs7OztJQUNILDhCQUFTOzs7OztJQUFULFVBQVUsTUFBcUI7UUFDN0IsSUFBSSxDQUFDLE1BQU0sd0JBQVEsYUFBYSxFQUFLLElBQUksQ0FBQyxNQUFNLEVBQUssTUFBTSxDQUFFLENBQUM7UUFDOUQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0tBQ2hDO0lBRUQ7OztPQUdHOzs7Ozs7SUFDSCw2QkFBUTs7Ozs7SUFBUixVQUFTLEtBQW1CO1FBQzFCLElBQUksQ0FBQyxLQUFLLHdCQUFRLElBQUksQ0FBQyxLQUFLLEVBQUssS0FBSyxDQUFFLENBQUM7UUFDekMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FB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LGFBQWEsQ0FBQyxhQUFhLEVBQTVDLENBQTRDLENBQ3RFLENBQ0YsQ0FBQztLQUNIO3FCQTdLSDtJQThLQyxDQUFBO0FBbktELHNCQW1LQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCB9IGZyb20gJ3J4anMvQmVoYXZpb3JTdWJqZWN0JztcclxuaW1wb3J0IHsgZmlsdGVyIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMvZmlsdGVyJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMvT2JzZXJ2YWJsZSc7XHJcbmltcG9ydCB7IGRlZmF1bHRDb25maWcsIGRlZmF1bHRTdGF0ZSB9IGZyb20gJy4uL3V0aWxzL2dhbGxlcnkuZGVmYXVsdCc7XHJcbmltcG9ydCB7XHJcbiAgR2FsbGVyeVN0YXRlLFxyXG4gIEdhbGxlcnlDb25maWcsXHJcbiAgR2FsbGVyeUFjdGlvbixcclxuICBHYWxsZXJ5SXRlbVxyXG59IGZyb20gJy4uL21vZGVscyc7XHJcblxyXG5leHBvcnQgY2xhc3MgR2FsbGVyeVJlZiB7XHJcbiAgc3RhdGUkOiBCZWhhdmlvclN1YmplY3Q8R2FsbGVyeVN0YXRlPjtcclxuICBjb25maWckOiBCZWhhdmlvclN1YmplY3Q8R2FsbGVyeUNvbmZpZz47XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHVibGljIGNvbmZpZzogR2FsbGVyeUNvbmZpZyA9IGRlZmF1bHRDb25maWcsXHJcbiAgICBwdWJsaWMgc3RhdGU6IEdhbGxlcnlTdGF0ZSA9IGRlZmF1bHRTdGF0ZVxyXG4gICkge1xyXG4gICAgdGhpcy5zdGF0ZSQgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PEdhbGxlcnlTdGF0ZT4oc3RhdGUpO1xyXG4gICAgdGhpcy5jb25maWckID0gbmV3IEJlaGF2aW9yU3ViamVjdDxHYWxsZXJ5Q29uZmlnPihkZWZhdWx0Q29uZmlnKTtcclxuICAgIHRoaXMuc2V0Q29uZmlnKGNvbmZpZyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXQgZ2FsbGVyeSBjb25maWdcclxuICAgKiBAcGFyYW0gY29uZmlnXHJcbiAgICovXHJcbiAgc2V0Q29uZmlnKGNvbmZpZzogR2FsbGVyeUNvbmZpZykge1xyXG4gICAgdGhpcy5jb25maWcgPSB7IC4uLmRlZmF1bHRDb25maWcsIC4uLnRoaXMuY29uZmlnLCAuLi5jb25maWcgfTtcclxuICAgIHRoaXMuY29uZmlnJC5uZXh0KHRoaXMuY29uZmlnKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNldCBnYWxsZXJ5IHN0YXRlXHJcbiAgICogQHBhcmFtIHN0YXRlXHJcbiAgICovXHJcbiAgc2V0U3RhdGUoc3RhdGU6IEdhbGxlcnlTdGF0ZSkge1xyXG4gICAgdGhpcy5zdGF0ZSA9IHsgLi4udGhpcy5zdGF0ZSwgLi4uc3RhdGUgfTtcclxuICAgIHRoaXMuc3RhdGUkLm5leHQodGhpcy5zdGF0ZSk7XHJcbiAgfVxyXG5cclxuICAvKiogQWRkIGdhbGxlcnkgaXRlbVxyXG4gICAqIEBwYXJhbSBpdGVtIC0gR2FsbGVyeSBpdGVtIG9iamVjdFxyXG4gICAqIEBwYXJhbSBhY3RpdmUgLSBTZXQgdGhlIG5ldyBpdGVtIGFzIGN1cnJlbnQgc2xpZGVcclxuICAgKi9cclxuICBhZGQoaXRlbTogR2FsbGVyeUl0ZW0sIGFjdGl2ZT86IGJvb2xlYW4pIHtcclxuICAgIGNvbnN0IGl0ZW1zID0gWy4uLnRoaXMuc3RhdGUuaXRlbXMsIGl0ZW1dO1xyXG4gICAgdGhpcy5zZXRTdGF0ZSh7XHJcbiAgICAgIGFjdGlvbjogR2FsbGVyeUFjdGlvbi5JVEVNU19DSEFOR0VELFxyXG4gICAgICBpdGVtczogaXRlbXMsXHJcbiAgICAgIGhhc05leHQ6IGl0ZW1zLmxlbmd0aCA+IDEsXHJcbiAgICAgIGN1cnJJbmRleDogYWN0aXZlID8gaXRlbXMubGVuZ3RoIC0gMSA6IHRoaXMuc3RhdGUuY3VyckluZGV4XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKiBSZW1vdmUgZ2FsbGVyeSBpdGVtXHJcbiAgICogQHBhcmFtIGkgLSBJdGVtIGluZGV4XHJcbiAgICovXHJcbiAgcmVtb3ZlKGk6IG51bWJlcikge1xyXG4gICAgY29uc3QgaXRlbXMgPSBbXHJcbiAgICAgIC4uLnRoaXMuc3RhdGUuaXRlbXMuc2xpY2UoMCwgaSksXHJcbiAgICAgIC4uLnRoaXMuc3RhdGUuaXRlbXMuc2xpY2UoaSArIDEsIHRoaXMuc3RhdGUuaXRlbXMubGVuZ3RoKVxyXG4gICAgXTtcclxuICAgIHRoaXMuc2V0U3RhdGUoe1xyXG4gICAgICBhY3Rpb246IEdhbGxlcnlBY3Rpb24uSVRFTVNfQ0hBTkdFRCxcclxuICAgICAgaXRlbXM6IGl0ZW1zLFxyXG4gICAgICBoYXNOZXh0OiBpdGVtcy5sZW5ndGggPiAxLFxyXG4gICAgICBoYXNQcmV2OiBpID4gMFxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBMb2FkIGl0ZW1zIGFuZCByZXNldCB0aGUgc3RhdGVcclxuICAgKiBAcGFyYW0gaXRlbXMgLSBHYWxsZXJ5IGltYWdlcyBkYXRhXHJcbiAgICovXHJcbiAgbG9hZChpdGVtczogR2FsbGVyeUl0ZW1bXSkge1xyXG4gICAgaWYgKGl0ZW1zKSB7XHJcbiAgICAgIHRoaXMuc2V0U3RhdGUoe1xyXG4gICAgICAgIGFjdGlvbjogR2FsbGVyeUFjdGlvbi5JVEVNU19DSEFOR0VELFxyXG4gICAgICAgIGl0ZW1zOiBpdGVtcyxcclxuICAgICAgICBoYXNOZXh0OiBpdGVtcy5sZW5ndGggPiAxLFxyXG4gICAgICAgIGhhc1ByZXY6IGZhbHNlXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0IGFjdGl2ZSBpdGVtXHJcbiAgICogQHBhcmFtIGkgLSBBY3RpdmUgSW5kZXhcclxuICAgKiBAcGFyYW0gYWN0aW9uIC0gQWN0aW9uIHR5cGVcclxuICAgKi9cclxuICBzZXQoaTogbnVtYmVyKSB7XHJcbiAgICBpZiAoaSAhPT0gdGhpcy5zdGF0ZS5jdXJySW5kZXgpIHtcclxuICAgICAgdGhpcy5zZXRTdGF0ZSh7XHJcbiAgICAgICAgYWN0aW9uOiBHYWxsZXJ5QWN0aW9uLklOREVYX0NIQU5HRUQsXHJcbiAgICAgICAgY3VyckluZGV4OiBpLFxyXG4gICAgICAgIGhhc05leHQ6IGkgPCB0aGlzLnN0YXRlLml0ZW1zLmxlbmd0aCAtIDEsXHJcbiAgICAgICAgaGFzUHJldjogaSA+IDBcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBOZXh0IGl0ZW1cclxuICAgKi9cclxuICBuZXh0KCkge1xyXG4gICAgaWYgKHRoaXMuc3RhdGUuaGFzTmV4dCkge1xyXG4gICAgICB0aGlzLnNldCh0aGlzLnN0YXRlLmN1cnJJbmRleCArIDEpO1xyXG4gICAgfSBlbHNlIGlmICh0aGlzLmNvbmZpZy5sb29wKSB7XHJcbiAgICAgIHRoaXMuc2V0KDApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUHJldiBpdGVtXHJcbiAgICovXHJcbiAgcHJldigpIHtcclxuICAgIGlmICh0aGlzLnN0YXRlLmhhc1ByZXYpIHtcclxuICAgICAgdGhpcy5zZXQodGhpcy5zdGF0ZS5jdXJySW5kZXggLSAxKTtcclxuICAgIH0gZWxzZSBpZiAodGhpcy5jb25maWcubG9vcCkge1xyXG4gICAgICB0aGlzLnNldCh0aGlzLnN0YXRlLml0ZW1zLmxlbmd0aCAtIDEpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzZXQgZ2FsbGVyeSB0byBpbml0aWFsIHN0YXRlXHJcbiAgICovXHJcbiAgcmVzZXQoKSB7XHJcbiAgICB0aGlzLnNldFN0YXRlKGRlZmF1bHRTdGF0ZSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBEZXN0cm95IEdhbGxlcnlSZWYgKGZvciBpbnRlcm5hbCB1c2Ugb25seSlcclxuICAgKi9cclxuICBkZXN0cm95KCkge1xyXG4gICAgdGhpcy5zdGF0ZSQuY29tcGxldGUoKTtcclxuICAgIHRoaXMuY29uZmlnJC5jb21wbGV0ZSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqIEdhbGxlcnkgRXZlbnRzICovXHJcblxyXG4gIC8qKlxyXG4gICAqIFN0cmVhbSB0aGF0IGVtaXRzIHdoZW4gZ2FsbGVyeSBpcyBpbml0aWFsaXplZC9yZXNldFxyXG4gICAqL1xyXG4gIGluaXRpYWxpemVkKCk6IE9ic2VydmFibGU8R2FsbGVyeVN0YXRlPiB7XHJcbiAgICByZXR1cm4gdGhpcy5zdGF0ZSQucGlwZShcclxuICAgICAgZmlsdGVyKFxyXG4gICAgICAgIChzdGF0ZTogR2FsbGVyeVN0YXRlKSA9PiBzdGF0ZS5hY3Rpb24gPT09IEdhbGxlcnlBY3Rpb24uSU5JVElBTElaRURcclxuICAgICAgKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFN0cmVhbSB0aGF0IGVtaXRzIHdoZW4gaXRlbXMgaXMgY2hhbmdlZCAoaXRlbXMgbG9hZGVkLCBpdGVtIGFkZGVkLCBpdGVtIHJlbW92ZWQpXHJcbiAgICovXHJcbiAgaXRlbXNDaGFuZ2VkKCk6IE9ic2VydmFibGU8R2FsbGVyeVN0YXRlPiB7XHJcbiAgICByZXR1cm4gdGhpcy5zdGF0ZSQucGlwZShcclxuICAgICAgZmlsdGVyKFxyXG4gICAgICAgIChzdGF0ZTogR2FsbGVyeVN0YXRlKSA9PiBzdGF0ZS5hY3Rpb24gPT09IEdhbGxlcnlBY3Rpb24uSVRFTVNfQ0hBTkdFRFxyXG4gICAgICApXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3RyZWFtIHRoYXQgZW1pdHMgd2hlbiBjdXJyZW50IGl0ZW0gaXMgY2hhbmdlZFxyXG4gICAqL1xyXG4gIGluZGV4Q2hhbmdlZCgpOiBPYnNlcnZhYmxlPEdhbGxlcnlTdGF0ZT4ge1xyXG4gICAgcmV0dXJuIHRoaXMuc3RhdGUkLnBpcGUoXHJcbiAgICAgIGZpbHRlcihcclxuICAgICAgICAoc3RhdGU6IEdhbGxlcnlTdGF0ZSkgPT4gc3RhdGUuYWN0aW9uID09PSBHYWxsZXJ5QWN0aW9uLklOREVYX0NIQU5HRURcclxuICAgICAgKVxyXG4gICAgKTtcclxuICB9XHJcbn1cclxuIl19